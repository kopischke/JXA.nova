{
  "identifier": "net.kopischke.jxa",
  "name": "JXA",
  "organization": "Kopischke",
  "description": "JavaScript for Automation (JXA) support in Nova.",
  "version": "1.0.2",
  "license": "MIT",
  "repository": "https://github.com/kopischke/JXA.nova",
  "bugs": "https://github.com/kopischke/JXA.nova/issues",
  "categories": ["languages", "completions", "tasks", "issues", "commands"],

  "entitlements": {
    "filesystem": "readwrite",
    "process": true
  },

  "main": "main.js",

  "activationEvents": [
    "onLanguage:javascript+jxa"
  ],

  "issueMatchers": {
    "jxa-linter-osacompile": {
      "pattern": {
        "regexp": "\\bon line (\\d+): (.+) \\((-?\\d+)\\)$",
        "message": 2,
        "code": 3,
        "line": 1,
        "severity": "error"
      },
      "linesStartAt1": false
    }
  },

  "configWorkspace": [
    {
      "key": "jxa.validation.mode",
      "title": "Validation",
      "type": "enum",
      "description": "Whether and when automatic validation of open JXA files should be performed.",
      "values": [
        [null, "Disabled"],
        ["onSave", "On Save"],
        ["onChange", "On Change"]
      ],
      "default": null
    }
  ],

  "commands": {
    "editor": [
      {
        "title": "Open file in Script Editor…",
        "command": "fileToEditor",
        "when": "editorHasFocus",
        "filters": {
          "syntaxes": ["javascript+jxa"]
        }
      },
      {
        "title": "Send selection to Script Editor…",
        "command": "selectionToEditor",
        "when": "editorHasSelection && !editorHasMultipleSelections",
        "filters": {
          "syntaxes": ["javascript+jxa"]
        }
      }
    ]
  },

  "taskTemplates": {
    "JXA Script Compilation": {
      "name": "Compile JXA Script",
      "description": "Compiles the current JavaScript for Automation (JXA) source file to a binary JXA script.",
      "persistent": false,
      "actions": ["build"],
      "task": {
        "shell": false,
        "command": "$ExtensionFolder/Scripts/bin/jxabuild",
        "args": [
          "$File",
          "$FileExtname"
        ],
        "env": {
          "JXABUILD_DIR": "$(Config:jxa.build.directory)",
          "JXABUILD_FORMAT": "$(Config:jxa.build.format)",
          "JXABUILD_EXEONLY": "$(Config:jxa.build.execute-only)",
          "JXABUILD_STAYOPEN": "$(Config:jxa.build.applet.stay-open)",
          "JXABUILD_SPLASHSCREEN": "$(Config:jxa.build.applet.splash-screen)"
        }
      },
      "config": [
        {
          "key": "jxa.build.directory",
          "title": "Build directory",
          "description": "The directory where to put the compiled scripts, relative to the project root.",
          "required": true,
          "type": "path",
          "allowFiles": false,
          "allowFolders": true,
          "relative": true,
          "default": "./build"
        },
        {
          "key": "jxa.build.options",
          "title": "Output format settings",
          "description": "The following options dictate what kind of script will be created.",
          "type": "section",
          "children": [
            {
              "key": "jxa.build.format",
              "title": "Script file format",
              "description": "The script format to compile to.",
              "required": true,
              "type": "enum",
              "values": [
                ["scpt", "Compiled script file (.scpt)"],
                ["scptd", "Compiled script bundle (.scptd)"],
                ["app", "Applet or Droplet (.app)"]
              ],
              "default": "scpt"
            },
            {
              "key": "jxa.build.execute-only",
              "title": "Save the resulting script as execute-only",
              "description": "Compile the script for execution only: the source code will not be available for editing in the compiled file.",
              "type": "boolean",
              "default": false
            }
          ]
        },
        {
          "key": "jxa.build.applet",
          "title": "Applet / Droplet settings",
          "description": "The following options are only relevant when creating a new bundled applet or droplet.",
          "type": "section",
          "children": [
            {
              "key": "jxa.build.applet.stay-open",
              "title": "Stay-open applet",
              "type": "boolean",
              "default": false
            },
            {
              "key": "jxa.build.applet.splash-screen",
              "title": "Use startup screen",
              "type": "boolean",
              "default": false
            }
          ]
        }
      ]
    },

    "JXA Script Execution": {
      "name": "Execute JXA script",
      "description": "Execute the current JavaScript for Automation (JXA) source code.",
      "persistent": false,
      "actions": ["run"],
      "task": {
        "shell": false,
        "command": "$ExtensionFolder/Scripts/bin/jxarun",
        "args": ["$File"],
        "env": {
          "JXARUN_CODE": "$SelectedText",
          "JXARUN_SELECTED": "$(Config:jxa.run.selected)",
          "JXARUN_READABLE": "$(Config:jxa.run.output.readable)"
        }
      },
      "config": [
        {
          "key": "jxa.run.selected",
          "title": "Run selection",
          "description": "Run the code of the primary selection in the editor. If this is unset, or if this is set and no code is selected, the whole source file will be run.",
          "type": "boolean",
          "default": false
        },
        {
          "key": "jxa.run.output.readable",
          "title": "Human readable output",
          "description": "Printing results in human-readable form means strings do not have quotes around them, characters are not escaped, brackets for arrays and braces for objects are omitted, etc. Apple consider this as “generally more useful”, but it can introduce ambiguities. To see the results in an unambiguous form that could be recompiled into the same value, switch this off.",
          "type": "boolean",
          "default": true
        }
      ]
    }
  }
}
